"use strict";(()=>{var exports={};exports.id=562,exports.ids=[562],exports.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32081:e=>{e.exports=require("child_process")},73292:e=>{e.exports=require("fs/promises")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},86971:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>p,originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>c,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>f});var a=t(95419),o=t(69108),n=t(99678),i=t(10487);let s="",u=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/analyze-audio/route",pathname:"/api/analyze-audio",filename:"route",bundlePath:"app/api/analyze-audio/route"},resolvedPagePath:"/Users/twain/Bluum/BLUUM 1.2/Bluum_1.2/app/api/analyze-audio/route.ts",nextConfigOutput:s,userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:c,headerHooks:p,staticGenerationBailout:f}=u,m="/api/analyze-audio/route";function h(){return(0,n.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:d})}},10487:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{GET:()=>GET,POST:()=>POST,dynamic:()=>dynamic,generateStaticParams:()=>generateStaticParams,runtime:()=>runtime});var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(78070);function getAuth(){return{userId:"auth-user-id"}}let pathModule=null,fsPromises=null,osModule=null,childProcess=null;try{pathModule=__webpack_require__(71017),fsPromises=__webpack_require__(73292),osModule=__webpack_require__(22037),childProcess=__webpack_require__(32081)}catch(e){console.warn("Modules natifs non disponibles pendant la compilation",e)}let dynamic="force-dynamic",runtime="nodejs";function generateStaticParams(){return[]}function GET(){return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__.Z.json({message:"Cette route sera g\xe9r\xe9e par Netlify Functions en production"})}async function POST(request){try{let{userId}=getAuth();if(!userId)return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__.Z("Unauthorized",{status:401});if(!pathModule||!fsPromises||!osModule||!childProcess)return console.warn("Modules natifs requis non disponibles - environnement de compilation"),next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__.Z.json({success:!1,message:"Cette fonction requiert des modules Node.js qui ne sont disponibles qu'a l'execution",duration:0,fileName:"example.mp3",fileSize:0});let formData=await request.formData(),audioFile=formData.get("file");if(!audioFile)return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__.Z.json({error:"No audio file provided"},{status:400});let tempDir=await fsPromises.mkdtemp(pathModule.join(osModule.tmpdir(),"audio-analyze-")),filePath=pathModule.join(tempDir,audioFile.name),buffer=Buffer.from(await audioFile.arrayBuffer());await fsPromises.writeFile(filePath,buffer);let ffprobePath="";if(process.env.FFPROBE_PATH)ffprobePath=process.env.FFPROBE_PATH;else try{ffprobePath=eval("require('@ffprobe-installer/ffprobe').path")}catch(error){console.warn("Impossible de charger ffprobe-installer:",error)}let{execSync}=childProcess,cmd=`"${ffprobePath}" -v error -show_entries format=duration -of json "${filePath}"`;try{let output=execSync(cmd).toString(),data=JSON.parse(output),duration=parseFloat(data.format.duration);return await fsPromises.unlink(filePath),await fsPromises.rmdir(tempDir),next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__.Z.json({success:!0,duration:duration,fileName:audioFile.name,fileSize:audioFile.size})}catch(error){return console.error("FFprobe error:",error),next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__.Z.json({success:!1,error:`Failed to analyze audio: ${error.message}`},{status:500})}}catch(error){return console.error("Error analyzing audio:",error),next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__.Z.json({success:!1,error:`Internal server error: ${error.message}`},{status:500})}}}};var __webpack_require__=require("../../../webpack-runtime.js");__webpack_require__.C(exports);var __webpack_exec__=e=>__webpack_require__(__webpack_require__.s=e),__webpack_exports__=__webpack_require__.X(0,[638,206],()=>__webpack_exec__(86971));module.exports=__webpack_exports__})();