"use strict";(()=>{var e={};e.id=598,e.ids=[598],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57147:e=>{e.exports=require("fs")},73292:e=>{e.exports=require("fs/promises")},71017:e=>{e.exports=require("path")},74521:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>j,originalPathname:()=>v,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>x,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>w});var i={};t.r(i),t.d(i,{GET:()=>m,dynamic:()=>l.D,generateStaticParams:()=>l.U,runtime:()=>d});var o=t(95419),s=t(69108),a=t(99678),n=t(78070),p=t(71017),u=t(73292),c=t(57147),l=t(70462);let d="nodejs";async function m(e){try{let e=(0,p.join)(process.cwd(),"public","temp-videos");if(!(0,c.existsSync)(e))return n.Z.json({success:!0,message:"Le r\xe9pertoire temporaire n'existe pas encore",deleted:0});let r=await (0,u.readdir)(e),t=r.filter(e=>e.endsWith(".mp4")),i=r.filter(e=>e.endsWith(".meta.json")),o=0,s=Date.now();for(let r of i)try{let t=(0,p.join)(e,r),i=await (0,u.readFile)(t,"utf-8"),a=JSON.parse(i);if(a.expires&&a.expires<s){let i=r.replace(".meta.json",""),s=(0,p.join)(e,i);(0,c.existsSync)(s)&&(await (0,u.unlink)(s),console.log(`Vid\xe9o expir\xe9e supprim\xe9e: ${i}`)),await (0,u.unlink)(t),console.log(`Fichier meta supprim\xe9: ${r}`),o++}}catch(e){console.error(`Erreur lors du traitement du fichier meta ${r}:`,e)}for(let r of t){let t=`${r}.meta.json`;if(!i.includes(t))try{let t=(0,p.join)(e,r);(await (0,u.readFile)(t).then(()=>({orphaned:!0})).catch(()=>({orphaned:!1}))).orphaned&&(await (0,u.unlink)(t),console.log(`Vid\xe9o orpheline supprim\xe9e: ${r}`),o++)}catch(e){console.error(`Erreur lors de la suppression de la vid\xe9o orpheline ${r}:`,e)}}return n.Z.json({success:!0,message:`${o} fichiers temporaires expir\xe9s ont \xe9t\xe9 supprim\xe9s`,deleted:o})}catch(e){return console.error("Erreur lors du nettoyage des fichiers temporaires:",e),n.Z.json({success:!1,error:e instanceof Error?e.message:"Erreur inconnue"},{status:500})}}let x=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/cleanup-temp/route",pathname:"/api/cleanup-temp",filename:"route",bundlePath:"app/api/cleanup-temp/route"},resolvedPagePath:"/Users/twain/Bluum/BLUUM 1.2/Bluum_1.2/app/api/cleanup-temp/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:g,headerHooks:j,staticGenerationBailout:w}=x,v="/api/cleanup-temp/route";function y(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},70462:(e,r,t)=>{t.d(r,{D:()=>i,U:()=>o});let i="force-static";function o(){return[]}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[638,206],()=>t(74521));module.exports=i})();