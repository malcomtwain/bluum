"use strict";exports.id=465,exports.ids=[465],exports.modules={29633:(e,t,o)=>{o.d(t,{Mo:()=>r,aF:()=>a,cL:()=>s}),o(3729);let a=()=>({isLoaded:!0,isSignedIn:!0,user:{id:"mock-user-id",firstName:"Demo",lastName:"User",username:"demo",fullName:"Demo User",imageUrl:"https://via.placeholder.com/150",primaryEmailAddress:{emailAddress:"demo@example.com"},getMetadata:()=>({})}}),s=({redirectUrl:e})=>null,r=({redirectUrl:e})=>null},72829:(e,t,o)=>{o.d(t,{$g:()=>i,Bi:()=>r,Hq:()=>s,KG:()=>p,OQ:()=>a,Sk:()=>l,cT:()=>d,qm:()=>m,tL:()=>f});let a=(0,o(36755).eI)("https://cvjfytrbzfqwxszhcmvq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2amZ5dHJiemZxd3hzemhjbXZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwMDc3ODUsImV4cCI6MjA1NjU4Mzc4NX0.tGEazNPRhhCuQ_PZOOm2lNIa7IIXAbOF_ZJLhSjUuaw"),s=async e=>{try{console.log("Attempting to save song:",{...e,url:"REDACTED"});let t={...e,user_id:String(e.user_id)},{data:o,error:s}=await a.from("songs").insert([t]).select().single();if(s)throw console.error("Supabase error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),Error(`Failed to save song: ${s.message}`);if(!o)throw Error("No data returned from insert operation");return console.log("Song saved successfully:",{id:o.id,title:o.title}),o}catch(e){throw console.error("Error in saveSong:",e),e}};async function r(e){let{data:t,error:o}=await a.from("songs").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(o)throw o;return t||[]}let l=async e=>{let{error:t}=await a.from("songs").delete().eq("id",e);if(t)throw t},i=async(e,t)=>{try{console.log("Attempting to update song:",{songId:e,updates:t});let{data:o,error:s}=await a.from("songs").update(t).eq("id",e).select().single();if(s)throw console.error("Supabase error details:",{message:s.message,details:s.details,hint:s.hint,code:s.code}),Error(`Failed to update song: ${s.message}`);if(!o)throw Error("No data returned from update operation");return console.log("Song updated successfully:",{id:o.id,title:o.title}),o}catch(e){throw console.error("Error in updateSongDetails:",e),e}},c=["templates","media","music","generated"];async function n(e){try{console.log(`Creating public bucket '${e}'...`);let{error:t}=await a.storage.createBucket(e,{public:!0,fileSizeLimit:10485760,allowedMimeTypes:["image/*","video/*","audio/*"]});if(t)return console.warn(`Error creating bucket '${e}': ${t.message}`),!1;return console.log(`Successfully created bucket '${e}'`),!0}catch(t){return console.warn(`Exception creating bucket '${e}':`,t),!1}}async function d(e,t,o){try{try{await g(t)}catch(e){console.warn(`Could not verify bucket '${t}', but will try upload anyway:`,e)}let a=await u(t,o,e);if(!a.success&&a.error?.message?.includes("bucket")&&(console.log(`Bucket '${t}' not found, attempting to create it...`),await n(t)&&(a=await u(t,o,e))),!a.success){if(a.error?.message?.includes("bucket")||a.error?.message?.includes("Bucket"))throw Error(`The storage bucket '${t}' does not exist or you don't have access to it. Please contact your administrator.`);if(a.error?.message?.includes("permission")||a.error?.message?.includes("access")||a.error?.message?.includes("policy"))throw Error(`You don't have permission to upload to '${t}'. This may be due to Row-Level Security (RLS) policies.`);throw a.error||Error("Unknown upload error")}return a.data}catch(e){throw console.error(`Error uploading file to bucket '${t}':`,e),e}}async function u(e,t,o){try{let{data:s,error:r}=await a.storage.from(e).upload(t,o,{cacheControl:"3600",upsert:!0});return{success:!r,data:s,error:r}}catch(e){return{success:!1,data:null,error:e instanceof Error?e:Error(String(e))}}}async function g(e){try{let{data:t,error:o}=await a.storage.listBuckets();if(o){console.warn(`Permission error listing buckets: ${o.message}`);return}if(!t){console.warn("No buckets data returned from Supabase");return}if(t.some(t=>t.name===e))console.log(`Bucket '${e}' already exists`);else{console.log(`Bucket '${e}' does not exist. Attempting to create...`);try{let{error:t}=await a.storage.createBucket(e,{public:!0,fileSizeLimit:10485760});t?console.warn(`Could not create bucket '${e}': ${t.message}`):console.log(`Bucket '${e}' created successfully`)}catch(t){console.warn(`Exception creating bucket '${e}':`,t)}}}catch(t){console.warn(`Error checking bucket '${e}':`,t)}}async function m(e,t){let{data:o}=a.storage.from(e).getPublicUrl(t);return o.publicUrl}async function p(){console.log("Initializing Supabase storage buckets...");let e={success:[],failed:[]},t=!1;try{let{data:e,error:o}=await a.storage.listBuckets();(t=!o&&Array.isArray(e))?console.log("User has admin access to storage buckets"):console.warn("User does not have admin access to list buckets:",o?.message)}catch(e){console.warn("Error checking admin access:",e)}for(let o of c)try{let s=!1;if(t?(await g(o),s=!0):s=await n(o),s)e.success.push(o);else try{let t=new File(["test"],"test.txt",{type:"text/plain"}),s=`test-${Date.now()}.txt`,r=await u(o,s,t);if(r.success){console.log(`Bucket '${o}' exists and is usable`),e.success.push(o);try{await a.storage.from(o).remove([s])}catch(e){}}else console.warn(`Bucket '${o}' is not usable:`,r.error),e.failed.push(o)}catch(t){console.warn(`Could not verify bucket '${o}' usability:`,t),e.failed.push(o)}}catch(t){console.warn(`Failed to initialize bucket '${o}':`,t),e.failed.push(o)}return e.success.length>0&&console.log(`Successfully initialized buckets: ${e.success.join(", ")}`),e.failed.length>0&&console.warn(`Failed to initialize buckets: ${e.failed.join(", ")}`),e.success.length>0}class h{static isAvailable(){try{return!1}catch(e){return!1}}static async storeFile(e,t,o){return new Promise((a,s)=>{try{let r=`local_storage_${t}_${o.replace(/[^a-zA-Z0-9]/g,"_")}`,l=new FileReader;l.onload=()=>{try{localStorage.setItem(r,l.result),console.log(`File stored locally with key: ${r}`),a(r)}catch(e){console.error("Error storing file in localStorage:",e),s(e)}},l.onerror=()=>s(Error("Failed to read file")),l.readAsDataURL(e)}catch(e){s(e)}})}static getFileUrl(e){try{return localStorage.getItem(e)}catch(e){return console.error("Error retrieving file from localStorage:",e),null}}}async function f(e,t,o){try{console.log(`Attempting to upload to Supabase bucket '${t}'...`);try{let a=await d(e,t,o);return console.log("Successfully uploaded to Supabase"),{storage:"supabase",path:o,bucket:t,data:a}}catch(a){if(console.warn("Supabase upload failed, trying local storage fallback:",a),h.isAvailable()){let a=await h.storeFile(e,t,o);return console.log("Successfully stored in local storage"),{storage:"local",path:a,bucket:"local",data:{path:a}}}throw Error("Local storage fallback is not available")}}catch(e){throw console.error("All storage methods failed:",e),e}}},55493:(e,t,o)=>{o.d(t,{B:()=>i});var a=o(19369),s=o(7892),r=o(44669);let l={templateImage:null,templatePosition:{x:0,y:0,scale:1},templateDuration:3,mediaFiles:[],selectedSongs:[],cachedSongs:[],hooks:[],selectedFonts:{withBackground:!0,normal:!1},generatedImages:[],generatedVideos:[]},i=(0,a.U)(e=>{l.mediaFiles&&(l.mediaFiles=l.mediaFiles.filter(e=>null!==e.url&&""!==e.url).map(e=>({...e,persisted:!0})));let t=t=>{e(e=>({...e,...t}))};return{...l,setTemplateImage:e=>t({templateImage:e}),setTemplatePosition:e=>t({templatePosition:e}),setTemplateDuration:e=>t({templateDuration:e}),addMediaFile:e=>{let o=i.getState();if((o.mediaFiles?.length||0)>=10){r.toast.error("Vous ne pouvez pas uploader plus de 10 fichiers au total");return}if(e.url.length>20971520){r.toast.error("Le fichier est trop grand. Maximum 20MB par fichier.");return}t({mediaFiles:[...o.mediaFiles||[],{...e,id:(0,s.Z)(),persisted:!0}]})},removeMediaFile:e=>{let o=i.getState();t({mediaFiles:o.mediaFiles?.filter(t=>t.id!==e)||[]})},removeMediaFiles:e=>{let o=i.getState();t({mediaFiles:o.mediaFiles?.filter(t=>!e.includes(t.id))||[]})},addSong:e=>{t({selectedSongs:[...i.getState().selectedSongs||[],{...e,id:e.id||(0,s.Z)()}]})},removeSong:e=>{let o=i.getState();t({selectedSongs:o.selectedSongs?.filter(t=>t.id!==e)||[]})},updateSong:(e,o)=>{let a=i.getState();t({selectedSongs:a.selectedSongs?.map(t=>t.id===e?{...t,...o}:t)||[]})},clearSongs:()=>t({selectedSongs:[]}),setCachedSongs:e=>t({cachedSongs:e}),addHook:e=>{t({hooks:[...i.getState().hooks||[],{...e,id:(0,s.Z)()}]})},removeHook:e=>{let o=i.getState();t({hooks:o.hooks?.filter(t=>t.id!==e)||[]})},updateHookPosition:(e,o)=>{let a=i.getState();t({hooks:a.hooks?.map(t=>t.id===e?{...t,position:o}:t)||[]})},toggleFont:e=>{let o=i.getState();t({selectedFonts:{...o.selectedFonts||{withBackground:!0,normal:!1},[e]:!o.selectedFonts?.[e]}})},addGeneratedImage:e=>{t({generatedImages:[...i.getState().generatedImages||[],{...e,id:(0,s.Z)()}]})},addGeneratedVideo:e=>{t({generatedVideos:[...i.getState().generatedVideos||[],{...e,id:(0,s.Z)()}]})},clearGeneratedContent:()=>t({generatedImages:[],generatedVideos:[]}),reset:()=>t(l)}})}};