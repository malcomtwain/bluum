(()=>{var e={};e.id=400,e.ids=[400,888,660],e.modules={1323:(e,t)=>{"use strict";Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},97688:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>x,default:()=>m,getServerSideProps:()=>h,getStaticPaths:()=>p,getStaticProps:()=>g,reportWebVitals:()=>f,routeModule:()=>N,unstable_getServerProps:()=>v,unstable_getServerSideProps:()=>j,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>y,unstable_getStaticProps:()=>w});var s=r(87093),l=r(35244),i=r(1323),o=r(51072),n=r.n(o),c=r(45780),d=r(41390),u=e([c,d]);[c,d]=u.then?(await u)():u;let m=(0,i.l)(d,"default"),g=(0,i.l)(d,"getStaticProps"),p=(0,i.l)(d,"getStaticPaths"),h=(0,i.l)(d,"getServerSideProps"),x=(0,i.l)(d,"config"),f=(0,i.l)(d,"reportWebVitals"),w=(0,i.l)(d,"unstable_getStaticProps"),y=(0,i.l)(d,"unstable_getStaticPaths"),b=(0,i.l)(d,"unstable_getStaticParams"),v=(0,i.l)(d,"unstable_getServerProps"),j=(0,i.l)(d,"unstable_getServerSideProps"),N=new s.PagesRouteModule({definition:{kind:l.x.PAGES,page:"/Editor",pathname:"/Editor",bundlePath:"",filename:""},components:{App:c.default,Document:n()},userland:d});a()}catch(e){a(e)}})},5194:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{p:()=>d});var s=r(20997),l=r(16689),i=r(7457),o=r(69304),n=r(22311),c=e([i,n]);[i,n]=c.then?(await c)():c;let d=({type:e,onUploadComplete:t,accept:r,maxFiles:a=1})=>{let[c,d]=(0,l.useState)(!1),[u,m]=(0,l.useState)(null),{uploadTemplate:g,uploadMedia:p,uploadMusic:h}=(0,o.$)(),{currentProjectId:x}=(0,n.m)(),f=async r=>{if(!x){m("No project selected");return}d(!0),m(null);try{for(let a of r){let r;switch(e){case"template":r=await g(a,x,{x:0,y:0,scale:1},5);break;case"media":r=await p(a,x,a.type.startsWith("image/")?"image":"video",0,0);break;case"music":r=await h(a,x,0)}t(r)}}catch(e){m(e instanceof Error?e.message:"Upload failed")}finally{d(!1)}},{getRootProps:w,getInputProps:y,isDragActive:b}=(0,i.useDropzone)({onDrop:f,accept:r,maxFiles:a});return(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{...w(),className:`border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors
          ${b?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,children:[s.jsx("input",{...y()}),c?(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mb-2"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Uploading..."})]}):(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm text-gray-600",children:b?"Drop the files here":`Drag and drop ${e} files here, or click to select files`}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["template"===e&&"Supported formats: PNG, JPG, JPEG","media"===e&&"Supported formats: MP4, MOV, PNG, JPG, JPEG","music"===e&&"Supported formats: MP3, WAV"]})]})]}),u&&s.jsx("p",{className:"mt-2 text-sm text-red-500",children:u})]})};a()}catch(e){a(e)}})},55961:(e,t,r)=>{"use strict";r.d(t,{d:()=>s});var a=r(20997);r(16689);let s=({content:e="",onChange:t})=>(0,a.jsxs)("div",{className:"hook-editor",children:[a.jsx("h3",{children:"Hook Editor"}),a.jsx("textarea",{value:e,onChange:e=>{t&&t(e.target.value)},className:"w-full h-40 p-2 border rounded",placeholder:"Enter your hook content here..."})]})},49370:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>c});var s=r(20997),l=r(16689),i=r(61977),o=r(86201),n=e([o]);function c(){let[e,t]=(0,l.useState)(""),[r,a]=(0,l.useState)(!1),[n,c]=(0,l.useState)(""),d=async t=>{if(t.preventDefault(),c(""),!e.trim()){o.toast.error("Veuillez entrer un code d'invitation");return}a(!0);try{if(await (0,i.uV)(e.trim())){let{user:t,error:r}=await (0,i.x4)(e.trim());t&&!r?(o.toast.success("Acc\xe8s autoris\xe9"),window.location.href="/"):(o.toast.error(r||"Erreur lors de la v\xe9rification du code"),c(r||"Erreur lors de la v\xe9rification du code"))}else o.toast.error("Code d'invitation invalide ou expir\xe9"),c("Code d'invitation invalide ou expir\xe9")}catch(t){console.error("Verification error:",t);let e=t?.message||"Erreur lors de la v\xe9rification";c(e),o.toast.error(e)}finally{a(!1)}};return s.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-[#0a0a0c] dark:bg-[#0a0a0c]",children:(0,s.jsxs)("div",{className:"w-full max-w-md mx-auto p-6 md:p-8 space-y-6 md:space-y-8 bg-gray-900 rounded-xl shadow-lg border border-gray-800",children:[(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2 text-white",children:"Bluum"}),s.jsx("p",{className:"text-gray-300 text-sm md:text-base",children:"Bienvenue sur notre plateforme de g\xe9n\xe9ration vid\xe9o"})]}),n&&s.jsx("div",{className:"bg-red-900/50 border border-red-700 text-red-200 p-3 rounded-lg text-sm",children:n}),(0,s.jsxs)("form",{onSubmit:d,className:"mt-6 md:mt-8 space-y-5",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"invitation-code",className:"block text-sm font-medium text-gray-200 mb-2",children:"Code d'invitation"}),s.jsx("input",{id:"invitation-code",type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"Entrez votre code d'invitation",className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-white placeholder-gray-500",required:!0})]}),s.jsx("button",{type:"submit",disabled:r||!e.trim(),className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:r?"V\xe9rification...":"Acc\xe9der au site"})]})]})})}o=(n.then?(await n)():n)[0],a()}catch(e){a(e)}})},17461:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{f:()=>n});var s=r(20997),l=r(22311),i=r(5194),o=e([l,i]);[l,i]=o.then?(await o)():o;let n=()=>{let{mediaFiles:e,selectedSongs:t,addMediaFile:r,removeMediaFile:a,addSong:o,removeSong:n}=(0,l.m)();return s.jsx("div",{className:"w-full max-w-4xl mx-auto p-4",children:(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Media Files"}),(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx(i.p,{type:"media",onUploadComplete:e=>r({type:"image",url:e,duration:3}),accept:{"image/*":[".png",".jpg",".jpeg"],"video/*":[".mp4",".mov"]},maxFiles:5}),e.length>0&&s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:e.map(e=>(0,s.jsxs)("div",{className:"relative group",children:["image"===e.type?s.jsx("img",{src:e.url,alt:"Media",className:"w-full h-32 object-cover rounded-lg"}):s.jsx("video",{src:e.url,className:"w-full h-32 object-cover rounded-lg",controls:!0}),s.jsx("button",{onClick:()=>a(e.id),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},e.id))})]})]}),(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Background Music"}),(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx(i.p,{type:"music",onUploadComplete:e=>o({url:e}),accept:{"audio/*":[".mp3",".wav"]},maxFiles:3}),t.length>0&&s.jsx("div",{className:"space-y-2",children:t.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[s.jsx("audio",{src:e.url,controls:!0,className:"flex-1 mr-4"}),s.jsx("button",{onClick:()=>n(e.id),className:"text-red-500 hover:text-red-700",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]},e.id))})]})]})]})})};a()}catch(e){a(e)}})},24267:(e,t,r)=>{"use strict";r.d(t,{x:()=>i});var a=r(16689),s=r(63212),l=r(61977);let i=()=>{let{user:e}=(0,s.a)();return(0,a.useEffect)(()=>{e&&(async()=>{await l.OQ.from("users").update({last_seen:new Date().toISOString()}).eq("id",e.id)})()},[e]),null}},52419:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{u:()=>c});var s=r(20997),l=r(16689),i=r(22311),o=r(5194),n=e([i,o]);[i,o]=n.then?(await n)():n;let c=()=>{let{templateImage:e,templatePosition:t,templateDuration:r,setTemplateImage:a,setTemplatePosition:n,setTemplateDuration:c}=(0,i.m)(),[d,u]=(0,l.useState)(!1),[m,g]=(0,l.useState)({x:0,y:0}),p=(0,l.useRef)(null),h=r=>{d&&e&&n({x:r.clientX-m.x,y:r.clientY-m.y,scale:t.scale})},x=()=>{u(!1)};return(0,l.useEffect)(()=>(d&&(window.addEventListener("mousemove",h),window.addEventListener("mouseup",x)),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",x)}),[d]),(0,s.jsxs)("div",{className:"w-full max-w-4xl mx-auto p-4",children:[(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Template Editor"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (seconds)"}),s.jsx("input",{type:"number",min:"1",max:"10",value:r,onChange:e=>c(Number(e.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),!e&&s.jsx(o.p,{type:"template",onUploadComplete:a,accept:{"image/*":[".png",".jpg",".jpeg"]}})]})]}),e&&s.jsx("div",{ref:p,className:"relative w-full aspect-video bg-gray-100 rounded-lg overflow-hidden",onWheel:r=>{if(!e)return;r.preventDefault();let a=r.deltaY>0?.9:1.1;n({...t,scale:Math.max(.1,Math.min(5,t.scale*a))})},children:s.jsx("div",{className:"absolute cursor-move",style:{left:t.x,top:t.y,transform:`scale(${t.scale})`},onMouseDown:r=>{e&&(u(!0),g({x:r.clientX-t.x,y:r.clientY-t.y}))},children:s.jsx("img",{src:e,alt:"Template",className:"max-w-none",draggable:!1})})})]})};a()}catch(e){a(e)}})},29126:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{o:()=>c});var s=r(20997),l=r(16689),i=r(22311),o=r(69304),n=e([i]);i=(n.then?(await n)():n)[0];let c=()=>{let{templateImage:e,mediaFiles:t,selectedSongs:r,generatedImages:a,addGeneratedVideo:n,currentProjectId:c,generatedVideos:d}=(0,i.m)(),{generateVideo:u}=(0,o.$)(),[m,g]=(0,l.useState)(!1),[p,h]=(0,l.useState)(null),x=async()=>{if(!e){h("Please select a template image");return}if(0===t.length){h("Please add at least one media file");return}if(0===a.length){h("Please generate at least one image with hooks");return}if(!c){h("No active project");return}g(!0),h(null);try{let s=await u(c,a[0].id,t[0].id,r.length>0?r[0].id:null);n({url:s.url||s.storage_path||"",template:e,media:t[0].url,hook:a[0].hook,font:a[0].font})}catch(e){h(e instanceof Error?e.message:"Failed to generate video")}finally{g(!1)}};return s.jsx("div",{className:"w-full max-w-4xl mx-auto p-4",children:(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{children:[s.jsx("button",{onClick:x,disabled:m||!e||0===t.length||0===a.length,className:`w-full px-4 py-2 rounded-md text-white transition-colors
              ${m||!e||0===t.length||0===a.length?"bg-gray-400 cursor-not-allowed":"bg-green-500 hover:bg-green-600"}`,children:m?"Generating Video...":"Generate Video"}),p&&s.jsx("p",{className:"mt-2 text-sm text-red-500",children:p})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Requirements"}),(0,s.jsxs)("ul",{className:"space-y-2",children:[(0,s.jsxs)("li",{className:"flex items-center space-x-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 ${e?"text-green-500":"text-gray-400"}`,viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),s.jsx("span",{className:e?"text-gray-900":"text-gray-500",children:"Template Image Selected"})]}),(0,s.jsxs)("li",{className:"flex items-center space-x-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 ${t.length>0?"text-green-500":"text-gray-400"}`,viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),s.jsx("span",{className:t.length>0?"text-gray-900":"text-gray-500",children:"Media Files Added"})]}),(0,s.jsxs)("li",{className:"flex items-center space-x-2",children:[s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 ${a.length>0?"text-green-500":"text-gray-400"}`,viewBox:"0 0 20 20",fill:"currentColor",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),s.jsx("span",{className:a.length>0?"text-gray-900":"text-gray-500",children:"Generated Images Available"})]})]})]}),(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Generated Videos"}),s.jsx("div",{className:"grid grid-cols-1 gap-4",children:d.map(e=>s.jsx("div",{className:"relative",children:s.jsx("video",{src:e.url,controls:!0,className:"w-full rounded-lg"})},e.id))})]})]})})};a()}catch(e){a(e)}})},63212:(e,t,r)=>{"use strict";r.d(t,{H:()=>o,a:()=>n});var a=r(20997),s=r(16689),l=r(61977);let i=(0,s.createContext)({user:null,isLoading:!0,logout:()=>{}});function o({children:e}){let[t,r]=(0,s.useState)(null),[o,n]=(0,s.useState)(!0);return(0,s.useEffect)(()=>((0,l.Z5)(),(0,l.Aj)(e=>{r(e),n(!1)})),[]),a.jsx(i.Provider,{value:{user:t,isLoading:o,logout:l.kS},children:e})}function n(){return(0,s.useContext)(i)}},22311:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.d(t,{m:()=>o});var s=r(66912),l=e([s]);s=(l.then?(await l)():l)[0];let i={currentProjectId:null,projectName:"",templateImage:null,templatePosition:{x:0,y:0,scale:1},templateDuration:3,mediaFiles:[],selectedSongs:[],hooks:[],selectedFonts:{withBackground:!0,normal:!1},generatedImages:[],generatedVideos:[]},o=(0,s.create)((e,t)=>({...i,setCurrentProject:(t,r)=>{e({currentProjectId:t,projectName:r})},setTemplateImage:t=>{e({templateImage:t})},setTemplatePosition:t=>{e({templatePosition:t})},setTemplateDuration:t=>{e({templateDuration:t})},addMediaFile:t=>{e(e=>({mediaFiles:[...e.mediaFiles,{id:crypto.randomUUID(),...t}]}))},removeMediaFile:t=>{e(e=>({mediaFiles:e.mediaFiles.filter(e=>e.id!==t)}))},addSong:t=>{e(e=>({selectedSongs:[...e.selectedSongs,{id:crypto.randomUUID(),...t}]}))},removeSong:t=>{e(e=>({selectedSongs:e.selectedSongs.filter(e=>e.id!==t)}))},addHook:t=>{e(e=>({hooks:[...e.hooks,{id:crypto.randomUUID(),...t}]}))},removeHook:t=>{e(e=>({hooks:e.hooks.filter(e=>e.id!==t)}))},toggleFont:t=>{e(e=>({selectedFonts:{...e.selectedFonts,[t]:!e.selectedFonts[t]}}))},addGeneratedImage:t=>{e(e=>({generatedImages:[...e.generatedImages,{id:crypto.randomUUID(),...t}]}))},addGeneratedVideo:t=>{e(e=>({generatedVideos:[...e.generatedVideos,{id:crypto.randomUUID(),...t}]}))},reset:()=>{e(i)}}));a()}catch(e){a(e)}})},69304:(e,t,r)=>{"use strict";r.d(t,{$:()=>g});var a=r(16689),s=r(63212);let l=(0,r(92885).createClient)("https://cvjfytrbzfqwxszhcmvq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2amZ5dHJiemZxd3hzemhjbXZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwMDc3ODUsImV4cCI6MjA1NjU4Mzc4NX0.tGEazNPRhhCuQ_PZOOm2lNIa7IIXAbOF_ZJLhSjUuaw");async function i(e){try{console.log(`Creating public bucket '${e}'...`);let{error:t}=await l.storage.createBucket(e,{public:!0,fileSizeLimit:10485760,allowedMimeTypes:["image/*","video/*","audio/*"]});if(t)return console.warn(`Error creating bucket '${e}': ${t.message}`),!1;return console.log(`Successfully created bucket '${e}'`),!0}catch(t){return console.warn(`Exception creating bucket '${e}':`,t),!1}}async function o(e,t,r){try{try{await c(t)}catch(e){console.warn(`Could not verify bucket '${t}', but will try upload anyway:`,e)}let a=await n(t,r,e);if(!a.success&&a.error?.message?.includes("bucket")&&(console.log(`Bucket '${t}' not found, attempting to create it...`),await i(t)&&(a=await n(t,r,e))),!a.success){if(a.error?.message?.includes("bucket")||a.error?.message?.includes("Bucket"))throw Error(`The storage bucket '${t}' does not exist or you don't have access to it. Please contact your administrator.`);if(a.error?.message?.includes("permission")||a.error?.message?.includes("access")||a.error?.message?.includes("policy"))throw Error(`You don't have permission to upload to '${t}'. This may be due to Row-Level Security (RLS) policies.`);throw a.error||Error("Unknown upload error")}return a.data}catch(e){throw console.error(`Error uploading file to bucket '${t}':`,e),e}}async function n(e,t,r){try{let{data:a,error:s}=await l.storage.from(e).upload(t,r,{cacheControl:"3600",upsert:!0});return{success:!s,data:a,error:s}}catch(e){return{success:!1,data:null,error:e instanceof Error?e:Error(String(e))}}}async function c(e){try{let{data:t,error:r}=await l.storage.listBuckets();if(r){console.warn(`Permission error listing buckets: ${r.message}`);return}if(!t){console.warn("No buckets data returned from Supabase");return}if(t.some(t=>t.name===e))console.log(`Bucket '${e}' already exists`);else{console.log(`Bucket '${e}' does not exist. Attempting to create...`);try{let{error:t}=await l.storage.createBucket(e,{public:!0,fileSizeLimit:10485760});t?console.warn(`Could not create bucket '${e}': ${t.message}`):console.log(`Bucket '${e}' created successfully`)}catch(t){console.warn(`Exception creating bucket '${e}':`,t)}}}catch(t){console.warn(`Error checking bucket '${e}':`,t)}}async function d(e,t){let{data:r}=l.storage.from(e).getPublicUrl(t);return r.publicUrl}class u{static isAvailable(){try{return!1}catch(e){return!1}}static async storeFile(e,t,r){return new Promise((a,s)=>{try{let l=`local_storage_${t}_${r.replace(/[^a-zA-Z0-9]/g,"_")}`,i=new FileReader;i.onload=()=>{try{localStorage.setItem(l,i.result),console.log(`File stored locally with key: ${l}`),a(l)}catch(e){console.error("Error storing file in localStorage:",e),s(e)}},i.onerror=()=>s(Error("Failed to read file")),i.readAsDataURL(e)}catch(e){s(e)}})}static getFileUrl(e){try{return localStorage.getItem(e)}catch(e){return console.error("Error retrieving file from localStorage:",e),null}}}async function m(e,t,r){try{console.log(`Attempting to upload to Supabase bucket '${t}'...`);try{let a=await o(e,t,r);return console.log("Successfully uploaded to Supabase"),{storage:"supabase",path:r,bucket:t,data:a}}catch(a){if(console.warn("Supabase upload failed, trying local storage fallback:",a),u.isAvailable()){let a=await u.storeFile(e,t,r);return console.log("Successfully stored in local storage"),{storage:"local",path:a,bucket:"local",data:{path:a}}}throw Error("Local storage fallback is not available")}}catch(e){throw console.error("All storage methods failed:",e),e}}function g(){let{user:e}=(0,s.a)(),[t,r]=(0,a.useState)(!1),[i,n]=(0,a.useState)(null),c=(0,a.useCallback)(async e=>{if(e.id)try{await l.from("users").upsert({id:e.id,email:e.email||"",username:e.username||"",full_name:e.fullName||"",avatar_url:e.avatarUrl||"",updated_at:new Date().toISOString()})}catch(e){console.error("Error syncing user data:",e)}},[]),u=(0,a.useCallback)(async t=>{if(!e)throw Error("User not authenticated");r(!0),n(null);try{let{data:r,error:a}=await l.from("users").upsert({id:e.id,email:e.email||""}).select().single();if(a)throw a;let{data:s,error:i}=await l.from("projects").insert({user_id:r.id,name:t}).select().single();if(i)throw i;return s}catch(e){throw n(e instanceof Error?e.message:"An error occurred"),e}finally{r(!1)}},[e]),g=(0,a.useCallback)(async(t,a,s,i)=>{if(!e)throw Error("User not authenticated");r(!0),n(null);try{let r;let o=`${e.id}/${a}/templates/${Date.now()}-${t.name}`,n=await m(t,"templates",o);if("supabase"===n.storage){let{data:e,error:t}=await l.from("templates").insert({project_id:a,storage_path:o,position_x:s.x,position_y:s.y,scale:s.scale,duration:i}).select().single();t?console.warn("Failed to insert template record in database:",t):r=e}if(r)r.storage_type=n.storage;else{let e=new Date().toISOString();r={id:`local_${Date.now()}`,project_id:a,storage_path:n.path,position_x:s.x,position_y:s.y,scale:s.scale,duration:i,created_at:e,storage_type:n.storage};try{let e=JSON.parse(localStorage.getItem("local_templates")||"[]");e.push(r),localStorage.setItem("local_templates",JSON.stringify(e))}catch(e){console.warn("Failed to store template metadata in localStorage:",e)}}return r}catch(e){throw n(e instanceof Error?e.message:"An error occurred"),e}finally{r(!1)}},[e]),p=(0,a.useCallback)(async(t,a,s,i,c)=>{if(!e)throw Error("User not authenticated");r(!0),n(null);try{let r=`${e.id}/${a}/media/${Date.now()}-${t.name}`;await o(t,"media",r);let{data:n,error:d}=await l.from("media").insert({project_id:a,storage_path:r,type:s,duration:i,order_index:c}).select().single();if(d)throw d;return n}catch(e){throw n(e instanceof Error?e.message:"An error occurred"),e}finally{r(!1)}},[e]),h=(0,a.useCallback)(async(t,a,s)=>{if(!e)throw Error("User not authenticated");r(!0),n(null);try{let r=`${e.id}/${a}/music/${Date.now()}-${t.name}`;await o(t,"music",r);let{data:i,error:n}=await l.from("music").insert({project_id:a,storage_path:r,order_index:s}).select().single();if(n)throw n;return i}catch(e){throw n(e instanceof Error?e.message:"An error occurred"),e}finally{r(!1)}},[e]);return{syncUser:c,createProject:u,uploadTemplate:g,uploadMedia:p,uploadMusic:h,addHook:(0,a.useCallback)(async(t,a,s)=>{if(!e)throw Error("User not authenticated");r(!0),n(null);try{let{data:e,error:r}=await l.from("hooks").insert({project_id:t,text:a,position_x:s.x,position_y:s.y}).select().single();if(r)throw r;return e}catch(e){throw n(e instanceof Error?e.message:"An error occurred"),e}finally{r(!1)}},[e]),generateImages:(0,a.useCallback)(async(t,a,s,i)=>{if(!e)throw Error("User not authenticated");r(!0),n(null);try{let{data:r,error:n}=await l.from("templates").select("*").eq("id",a).single();if(n)throw n;let{data:c,error:u}=await l.from("hooks").select("*").eq("id",s).single();if(u)throw u;let m=await d("templates",r.storage_path),g=await null.generateImageWithHook(m,c.text,{type:"withBackground"===i?2:1,position:"middle",offset:0}),p=`${Date.now()}-image.png`,h=new File([g],p,{type:"image/png"}),x=`${e.id}/${t}/generated/${p}`;await o(h,"generated",x);let{data:f,error:w}=await l.from("generated_images").insert({project_id:t,template_id:a,hook_id:s,storage_path:x,font_type:i}).select().single();if(w)throw w;return f}catch(e){throw n(e instanceof Error?e.message:"An error occurred"),e}finally{r(!1)}},[e]),generateVideo:(0,a.useCallback)(async(t,a,s,i)=>{if(!e)throw Error("User not authenticated");r(!0),n(null);try{let{data:r,error:n}=await l.from("generated_images").select(`
          *,
          template:templates(*),
          hook:hooks(*)
        `).eq("id",a).single();if(n)throw n;let{data:c,error:u}=await l.from("media").select("*").eq("id",s).single();if(u)throw u;let{data:m,error:g}=i?await l.from("music").select("*").eq("id",i).single():{data:null,error:null};if(g)throw g;let p=await d("generated",r.storage_path),h=await d("media",c.storage_path),x=m?await d("music",m.storage_path):null,f=await null.generateVideoWithFFmpeg({templateImage:p,mediaFile:h,hookText:r.hook.text,hookStyle:{type:"withBackground"===r.font_type?2:1,position:"middle",offset:0},musicFile:x||void 0}),w=`${Date.now()}-video.mp4`,y=new File([f],w,{type:"video/mp4"}),b=`${e.id}/${t}/generated/${w}`;await o(y,"generated",b);let{data:v,error:j}=await l.from("generated_videos").insert({project_id:t,generated_image_id:a,media_id:s,music_id:i,storage_path:b}).select().single();if(j)throw j;return v}catch(e){throw n(e instanceof Error?e.message:"An error occurred"),e}finally{r(!1)}},[e]),isLoading:t,error:i}}},61977:(e,t,r)=>{"use strict";r.d(t,{Aj:()=>d,OQ:()=>a,Z5:()=>u,kS:()=>n,uV:()=>i,x4:()=>o});let a=(0,r(92885).createClient)("https://cvjfytrbzfqwxszhcmvq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2amZ5dHJiemZxd3hzemhjbXZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwMDc3ODUsImV4cCI6MjA1NjU4Mzc4NX0.tGEazNPRhhCuQ_PZOOm2lNIa7IIXAbOF_ZJLhSjUuaw"),s=null,l=[];async function i(e){let{data:t,error:r}=await a.from("invitation_codes").select("*").eq("code",e).eq("is_active",!0).single();if(r||!t)return!1;let s=new Date;return!(t.expires_at&&new Date(t.expires_at)<s)&&!(t.uses_count>=t.uses_allowed)}async function o(e){let{data:t,error:r}=await a.from("users").select("*").eq("username",e).single();if(!t||r){if(!await i(e))return{user:null,error:"Code d'invitation invalide"};let t={id:`temp_${Date.now()}`,username:"Invit\xe9",invitationCode:e};return c(t),{user:t,error:null}}await a.from("users").update({last_login:new Date().toISOString()}).eq("id",t.id);let s={id:t.id,email:t.email,username:t.username,fullName:t.full_name,avatarUrl:t.avatar_url};return c(s),{user:s,error:null}}function n(){c(null)}function c(e){s=e,l.forEach(t=>t(e))}function d(e){return l.push(e),e(s),()=>{let t=l.indexOf(e);-1!==t&&l.splice(t,1)}}function u(){}},41390:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{EditorComponent:()=>g,default:()=>m,getServerSideProps:()=>u});var s=r(20997),l=r(16689),i=r(52419),o=r(17461),n=r(55961),c=r(29126),d=e([i,o,c]);[i,o,c]=d.then?(await d)():d;let g=()=>{let[e,t]=(0,l.useState)("template"),r=[{id:"template",label:"Template"},{id:"media",label:"Media"},{id:"hooks",label:"Hooks"},{id:"generate",label:"Generate"}];return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("header",{className:"bg-white shadow",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Bluum Editor"})})}),s.jsx("nav",{className:"bg-white border-b",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4",children:s.jsx("div",{className:"flex space-x-8",children:r.map(r=>s.jsx("button",{onClick:()=>t(r.id),className:`py-4 px-1 border-b-2 font-medium text-sm
                  ${e===r.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:r.label},r.id))})})}),s.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:["template"===e&&s.jsx(i.u,{}),"media"===e&&s.jsx(o.f,{}),"hooks"===e&&s.jsx(n.d,{}),"generate"===e&&s.jsx(c.o,{})]})}),s.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between",children:[s.jsx("button",{onClick:()=>{let a=r.findIndex(t=>t.id===e);a>0&&t(r[a-1].id)},disabled:"template"===e,className:`px-4 py-2 rounded-md text-white
              ${"template"===e?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:"Previous"}),s.jsx("button",{onClick:()=>{let a=r.findIndex(t=>t.id===e);a<r.length-1&&t(r[a+1].id)},disabled:"generate"===e,className:`px-4 py-2 rounded-md text-white
              ${"generate"===e?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:"Next"})]})})]})};function u(){return{props:{}}}function m(){return s.jsx(g,{})}a()}catch(e){a(e)}})},45780:(e,t,r)=>{"use strict";r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>m});var s=r(20997),l=r(86201),i=r(24267),o=r(63212),n=r(11163),c=r(49370);r(86764);var d=e([l,c]);function u({children:e}){let{user:t,isLoading:r}=(0,o.a)(),a=(0,n.useRouter)();return r?s.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-900",children:s.jsx("div",{className:"text-white text-xl",children:"Chargement..."})}):t||["/login","/signup","/invitation"].includes(a.pathname)?s.jsx(s.Fragment,{children:e}):s.jsx(c.Z,{})}[l,c]=d.then?(await d)():d;let m=function({Component:e,pageProps:t}){return(0,s.jsxs)(o.H,{children:[s.jsx(i.x,{}),s.jsx(l.Toaster,{position:"bottom-right"}),s.jsx(u,{children:s.jsx(e,{...t})})]})};a()}catch(e){a(e)}})},86764:()=>{},35244:(e,t)=>{"use strict";var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},92885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},62785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},16689:e=>{"use strict";e.exports=require("react")},66405:e=>{"use strict";e.exports=require("react-dom")},20997:e=>{"use strict";e.exports=require("react/jsx-runtime")},7457:e=>{"use strict";e.exports=import("react-dropzone")},86201:e=>{"use strict";e.exports=import("react-hot-toast")},66912:e=>{"use strict";e.exports=import("zustand")},57147:e=>{"use strict";e.exports=require("fs")},71017:e=>{"use strict";e.exports=require("path")},12781:e=>{"use strict";e.exports=require("stream")},59796:e=>{"use strict";e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[894,163,72],()=>r(97688));module.exports=a})();