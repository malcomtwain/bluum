(()=>{var e={};e.id=888,e.ids=[888],e.modules={49370:(e,t,r)=>{"use strict";r.a(e,async(e,i)=>{try{r.d(t,{Z:()=>l});var s=r(20997),a=r(16689),n=r(61977),o=r(86201),u=e([o]);function l(){let[e,t]=(0,a.useState)(""),[r,i]=(0,a.useState)(!1),[u,l]=(0,a.useState)(""),c=async t=>{if(t.preventDefault(),l(""),!e.trim()){o.toast.error("Veuillez entrer un code d'invitation");return}i(!0);try{if(await (0,n.uV)(e.trim())){let{user:t,error:r}=await (0,n.x4)(e.trim());t&&!r?(o.toast.success("Acc\xe8s autoris\xe9"),window.location.href="/"):(o.toast.error(r||"Erreur lors de la v\xe9rification du code"),l(r||"Erreur lors de la v\xe9rification du code"))}else o.toast.error("Code d'invitation invalide ou expir\xe9"),l("Code d'invitation invalide ou expir\xe9")}catch(t){console.error("Verification error:",t);let e=t?.message||"Erreur lors de la v\xe9rification";l(e),o.toast.error(e)}finally{i(!1)}};return s.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-[#0a0a0c] dark:bg-[#0a0a0c]",children:(0,s.jsxs)("div",{className:"w-full max-w-md mx-auto p-6 md:p-8 space-y-6 md:space-y-8 bg-gray-900 rounded-xl shadow-lg border border-gray-800",children:[(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-bold mb-2 text-white",children:"Bluum"}),s.jsx("p",{className:"text-gray-300 text-sm md:text-base",children:"Bienvenue sur notre plateforme de g\xe9n\xe9ration vid\xe9o"})]}),u&&s.jsx("div",{className:"bg-red-900/50 border border-red-700 text-red-200 p-3 rounded-lg text-sm",children:u}),(0,s.jsxs)("form",{onSubmit:c,className:"mt-6 md:mt-8 space-y-5",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"invitation-code",className:"block text-sm font-medium text-gray-200 mb-2",children:"Code d'invitation"}),s.jsx("input",{id:"invitation-code",type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"Entrez votre code d'invitation",className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-white placeholder-gray-500",required:!0})]}),s.jsx("button",{type:"submit",disabled:r||!e.trim(),className:"w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:r?"V\xe9rification...":"Acc\xe9der au site"})]})]})})}o=(u.then?(await u)():u)[0],i()}catch(e){i(e)}})},24267:(e,t,r)=>{"use strict";r.d(t,{x:()=>n});var i=r(16689),s=r(63212),a=r(61977);let n=()=>{let{user:e}=(0,s.a)();return(0,i.useEffect)(()=>{e&&(async()=>{await a.OQ.from("users").update({last_seen:new Date().toISOString()}).eq("id",e.id)})()},[e]),null}},63212:(e,t,r)=>{"use strict";r.d(t,{H:()=>o,a:()=>u});var i=r(20997),s=r(16689),a=r(61977);let n=(0,s.createContext)({user:null,isLoading:!0,logout:()=>{}});function o({children:e}){let[t,r]=(0,s.useState)(null),[o,u]=(0,s.useState)(!0);return(0,s.useEffect)(()=>((0,a.Z5)(),(0,a.Aj)(e=>{r(e),u(!1)})),[]),i.jsx(n.Provider,{value:{user:t,isLoading:o,logout:a.kS},children:e})}function u(){return(0,s.useContext)(n)}},61977:(e,t,r)=>{"use strict";r.d(t,{Aj:()=>c,OQ:()=>i,Z5:()=>d,kS:()=>u,uV:()=>n,x4:()=>o});let i=(0,r(92885).createClient)("https://cvjfytrbzfqwxszhcmvq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN2amZ5dHJiemZxd3hzemhjbXZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwMDc3ODUsImV4cCI6MjA1NjU4Mzc4NX0.tGEazNPRhhCuQ_PZOOm2lNIa7IIXAbOF_ZJLhSjUuaw"),s=null,a=[];async function n(e){let{data:t,error:r}=await i.from("invitation_codes").select("*").eq("code",e).eq("is_active",!0).single();if(r||!t)return!1;let s=new Date;return!(t.expires_at&&new Date(t.expires_at)<s)&&!(t.uses_count>=t.uses_allowed)}async function o(e){let{data:t,error:r}=await i.from("users").select("*").eq("username",e).single();if(!t||r){if(!await n(e))return{user:null,error:"Code d'invitation invalide"};let t={id:`temp_${Date.now()}`,username:"Invit\xe9",invitationCode:e};return l(t),{user:t,error:null}}await i.from("users").update({last_login:new Date().toISOString()}).eq("id",t.id);let s={id:t.id,email:t.email,username:t.username,fullName:t.full_name,avatarUrl:t.avatar_url};return l(s),{user:s,error:null}}function u(){l(null)}function l(e){s=e,a.forEach(t=>t(e))}function c(e){return a.push(e),e(s),()=>{let t=a.indexOf(e);-1!==t&&a.splice(t,1)}}function d(){}},45780:(e,t,r)=>{"use strict";r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{default:()=>m});var s=r(20997),a=r(86201),n=r(24267),o=r(63212),u=r(11163),l=r(49370);r(86764);var c=e([a,l]);function d({children:e}){let{user:t,isLoading:r}=(0,o.a)(),i=(0,u.useRouter)();return r?s.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-900",children:s.jsx("div",{className:"text-white text-xl",children:"Chargement..."})}):t||["/login","/signup","/invitation"].includes(i.pathname)?s.jsx(s.Fragment,{children:e}):s.jsx(l.Z,{})}[a,l]=c.then?(await c)():c;let m=function({Component:e,pageProps:t}){return(0,s.jsxs)(o.H,{children:[s.jsx(n.x,{}),s.jsx(a.Toaster,{position:"bottom-right"}),s.jsx(d,{children:s.jsx(e,{...t})})]})};i()}catch(e){i(e)}})},86764:()=>{},92885:e=>{"use strict";e.exports=require("@supabase/supabase-js")},62785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},16689:e=>{"use strict";e.exports=require("react")},66405:e=>{"use strict";e.exports=require("react-dom")},20997:e=>{"use strict";e.exports=require("react/jsx-runtime")},86201:e=>{"use strict";e.exports=import("react-hot-toast")},57147:e=>{"use strict";e.exports=require("fs")},12781:e=>{"use strict";e.exports=require("stream")},59796:e=>{"use strict";e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[894,163],()=>r(45780));module.exports=i})();