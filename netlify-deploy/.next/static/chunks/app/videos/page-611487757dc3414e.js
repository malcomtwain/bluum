(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[55],{5987:function(e,t,r){Promise.resolve().then(r.bind(r,4683))},4683:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return p}});var s=r(3827),a=r(7977);let l=(0,a.Z)("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),o=(0,a.Z)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),c=(0,a.Z)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]),i=(0,a.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var n=r(489),d=r(9369),h=r(7907),u=r(8227),m=r(4090),g=r(8312),f=r(9414);function p(){(0,h.useRouter)();let{videos:e,removeVideo:t,clearExpiredVideos:r,selectedVideos:a,toggleVideoSelection:p,selectAllVideos:x,deselectAllVideos:v,removeSelectedVideos:b,getSelectedVideoPaths:y}=(0,u.J)(),[k,w]=(0,m.useState)(!1),[j,N]=(0,m.useState)(!1);(0,m.useEffect)(()=>{r(),w(!0)},[r]);let V=async e=>{try{let t=e.includes("supabase.co")||e.includes("supabase.in")||e.startsWith("http")?e:e.startsWith("/")?e:"/".concat(e),r=await fetch(t);if(!r.ok)throw Error("Failed to download video");let s=await r.blob(),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a;let o=e.split("/").pop()||"video.mp4";l.download=o,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)}catch(e){console.error("Error downloading video:",e),f.default.error("\xc9chec du t\xe9l\xe9chargement. Veuillez r\xe9essayer.")}},E=async()=>{try{if(0===a.length){f.default.error("Veuillez s\xe9lectionner au moins une vid\xe9o");return}N(!0),f.default.loading("Pr\xe9paration du t\xe9l\xe9chargement...");let e=y();if(console.log("Lancement du t\xe9l\xe9chargement ZIP pour",e.length,"vid\xe9os"),0===e.length)throw Error("Aucune vid\xe9o s\xe9lectionn\xe9e \xe0 t\xe9l\xe9charger");let t=!1;if(e.forEach((e,r)=>{e.path||(console.error("Vid\xe9o ".concat(r," a un chemin invalide:"),e),t=!0)}),t)throw Error("Certaines vid\xe9os ont des chemins invalides");await (0,g.V)(e,"bluum_videos.zip"),f.default.dismiss(),f.default.success("".concat(e.length," vid\xe9os t\xe9l\xe9charg\xe9es avec succ\xe8s"))}catch(t){console.error("Erreur d\xe9taill\xe9e lors du t\xe9l\xe9chargement des vid\xe9os:",t),f.default.dismiss();let e=t instanceof Error?t.message:"Erreur inconnue";f.default.error("\xc9chec du t\xe9l\xe9chargement: ".concat(e))}finally{N(!1)}},Z=e=>{let t=e-Date.now();if(t<=0)return"Expir\xe9";if(t<36e5){let e=Math.floor(t/6e4),r=Math.floor(t%6e4/1e3);return 0===e?"".concat(r,"s"):"".concat(e,"m ").concat(r,"s")}return"".concat(Math.floor(t/36e5),"h ").concat(Math.floor(t%36e5/6e4),"m")};return k?(0,s.jsx)("div",{className:"p-6 xl:p-8 w-full h-[calc(100vh-65px)]",children:e.length>0?(0,s.jsxs)("div",{className:"w-full max-w-4xl mx-auto",children:[(0,s.jsx)("div",{className:"flex justify-center mb-4",children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 justify-center",children:[(0,s.jsx)("button",{onClick:()=>{a.length===e.length?v():x()},className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-[#fafafa] dark:bg-[#0a0a0c] dark:text-white border dark:border-[#0a0a0c] rounded-lg hover:bg-gray-50 dark:hover:bg-[#0a0a0c]/80",children:a.length===e.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l,{className:"w-4 h-4"}),"Deselect All"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o,{className:"w-4 h-4"}),"Select All"]})}),a.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:E,disabled:j,className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-[#fafafa] dark:bg-[#0a0a0c] dark:text-white border dark:border-[#0a0a0c] rounded-lg hover:bg-gray-50 dark:hover:bg-[#0a0a0c]/80 ".concat(j?"opacity-50 cursor-not-allowed":""),children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c,{className:"w-4 h-4 animate-spin"}),"T\xe9l\xe9chargement..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i,{className:"w-4 h-4"}),"T\xe9l\xe9charger (",a.length,")"]})}),(0,s.jsxs)("button",{onClick:()=>{if(0===a.length){f.default.error("Veuillez s\xe9lectionner au moins une vid\xe9o");return}let e=a.length;b(),f.default.success("".concat(e," vid\xe9os supprim\xe9es"))},disabled:j,className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-[#fafafa] dark:bg-[#0a0a0c] text-red-500 border dark:border-[#0a0a0c] rounded-lg hover:bg-gray-50 dark:hover:bg-[#0a0a0c]/80 ".concat(j?"opacity-50 cursor-not-allowed":""),children:[(0,s.jsx)(n.Z,{className:"w-4 h-4"}),"Supprimer (",a.length,")"]})]})]})}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:e.map(e=>(0,s.jsxs)("div",{className:"relative bg-white dark:bg-[#0a0a0c] rounded-3xl overflow-hidden hover:shadow-lg transition-shadow",children:[(0,s.jsxs)("div",{className:"aspect-video relative bg-gray-100 dark:bg-[#18181A]",children:[(0,s.jsx)("video",{src:e.path,className:"w-full h-full object-cover"}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("input",{type:"checkbox",checked:a.includes(e.id),onChange:()=>p(e.id),className:"absolute top-2 left-2 h-4 w-4 rounded border-gray-300 text-[#5564ff] focus:ring-[#5564ff]"})})]}),(0,s.jsx)("div",{className:"p-3",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-medium mb-1 truncate dark:text-white",children:["Vid\xe9o ",e.id]}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground dark:text-gray-300 mb-2",children:["Expire dans ",Z(e.expiresAt)]})]}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("button",{onClick:()=>V(e.path),className:"p-1 text-[#5564ff] hover:bg-[#5564ff]/10 rounded-md transition-colors",title:"T\xe9l\xe9charger la vid\xe9o",children:(0,s.jsx)(i,{className:"w-3 h-3"})}),(0,s.jsx)("button",{onClick:()=>t(e.id),className:"p-1 text-red-500 hover:bg-red-500/10 rounded-md transition-colors",title:"Supprimer la vid\xe9o",children:(0,s.jsx)(n.Z,{className:"w-3 h-3"})})]})]})})]},e.id))})]}):(0,s.jsx)("div",{className:"flex items-center justify-center h-full w-full",children:(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(d.Z,{className:"w-16 h-16 text-gray-400 dark:text-gray-500"})}),(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-4 dark:text-white",children:"You have no videos"}),(0,s.jsx)("p",{className:"text-muted-foreground dark:text-gray-300",children:"Visit the Create page to make your first video."})]})})})}):null}},489:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(7977).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},9369:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(7977).Z)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]])},8227:function(e,t,r){"use strict";r.d(t,{J:function(){return l},d:function(){return o}});var s=r(2574),a=r(5249);let l=(0,s.U)()((0,a.tJ)((e,t)=>({videos:[],selectedVideos:[],addVideo:(r,s)=>{let a=Date.now(),l="",o=r.includes("/temp-videos/");try{let e=r.split("/");(l=e[e.length-1])&&""!==l||(l="video_".concat(a,".mp4"))}catch(e){l="video_".concat(a,".mp4")}let c=t().videos.find(e=>e.path===r);if(c){e(e=>({videos:e.videos.map(e=>e.id===c.id?{...e,expiresAt:s||a+9e5}:e)}));return}let i={id:Math.random().toString(36).substring(2,15),path:r,fileName:l,createdAt:a,expiresAt:s||a+9e5,isTemporary:o,selected:!1};e(e=>({videos:[...e.videos,i]})),o&&setTimeout(()=>{t().triggerCleanup()},901e3)},removeVideo:t=>{e(e=>({videos:e.videos.filter(e=>e.id!==t),selectedVideos:e.selectedVideos.filter(e=>e!==t)}))},clearExpiredVideos:()=>{let t=Date.now();e(e=>{let r=e.videos.filter(e=>e.expiresAt>t),s=e.selectedVideos.filter(e=>r.some(t=>t.id===e));return{videos:r,selectedVideos:s}})},triggerCleanup:async()=>{try{let e=await fetch("/api/cleanup-temp");return t().clearExpiredVideos(),console.log("Nettoyage des fichiers temporaires d\xe9clench\xe9"),await e.json()}catch(e){console.error("Erreur lors du nettoyage:",e),t().clearExpiredVideos()}},toggleVideoSelection:t=>{e(e=>e.selectedVideos.includes(t)?{selectedVideos:e.selectedVideos.filter(e=>e!==t)}:{selectedVideos:[...e.selectedVideos,t]})},selectAllVideos:()=>{e(e=>({selectedVideos:e.videos.map(e=>e.id)}))},deselectAllVideos:()=>{e({selectedVideos:[]})},removeSelectedVideos:()=>{e(e=>({videos:e.videos.filter(t=>!e.selectedVideos.includes(t.id)),selectedVideos:[]}))},getSelectedVideoPaths:()=>{let{videos:e,selectedVideos:r}=t();return e.filter(e=>r.includes(e.id)).map(e=>({path:e.path,fileName:e.fileName}))}}),{name:"bluum-user-videos",partialize:e=>({videos:e.videos,selectedVideos:e.selectedVideos})})),o=()=>{l.getState().clearExpiredVideos(),l.getState().triggerCleanup();let e=setInterval(()=>{l.getState().clearExpiredVideos(),l.getState().triggerCleanup()},3e5);return()=>clearInterval(e)}},8312:function(e,t,r){"use strict";r.d(t,{V:function(){return o}});var s=r(1101),a=r.n(s),l=r(2599);async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bluum_videos.zip";if(!e||0===e.length){console.error("Aucune vid\xe9o \xe0 t\xe9l\xe9charger");return}console.log("D\xe9but du processus de t\xe9l\xe9chargement pour ".concat(e.length," vid\xe9os")),console.log("Vid\xe9os \xe0 t\xe9l\xe9charger:",e);try{if(!a())throw Error("JSZip n'est pas disponible");if(!l.saveAs)throw Error("saveAs n'est pas disponible");let r=new(a());console.log("Instance JSZip cr\xe9\xe9e");let s=0,o=e.length,c=r.folder("videos");if(!c)throw Error("Impossible de cr\xe9er le dossier dans le ZIP");console.log('Dossier "videos" cr\xe9\xe9 dans le ZIP');let i=e.map(async(e,t)=>{try{console.log("T\xe9l\xe9chargement de la vid\xe9o ".concat(t+1,"/").concat(o,": ").concat(e.fileName," depuis ").concat(e.path));let r=await fetch(e.path);if(!r.ok)throw Error("\xc9chec du t\xe9l\xe9chargement de la vid\xe9o ".concat(e.fileName,": ").concat(r.status," ").concat(r.statusText));console.log("Vid\xe9o ".concat(t+1," r\xe9cup\xe9r\xe9e avec succ\xe8s, conversion en blob..."));let a=await r.blob();console.log("Taille du blob pour ".concat(e.fileName,": ").concat(a.size," octets"));let l=function(e,t){let r=e.lastIndexOf("."),s=r>0?e.substring(0,r):e,a=r>0?e.substring(r):"";return"".concat(s,"_").concat(t+1).concat(a)}(e.fileName,t);c.file(l,a),s++,console.log("T\xe9l\xe9chargement ".concat(s,"/").concat(o,": ").concat(e.fileName," ajout\xe9 au ZIP"))}catch(t){console.error("Erreur lors du t\xe9l\xe9chargement de ".concat(e.fileName,":"),t)}});if(console.log("Attente de tous les t\xe9l\xe9chargements..."),await Promise.all(i),0===s)throw Error("Aucune vid\xe9o n'a pu \xeatre t\xe9l\xe9charg\xe9e");console.log("G\xe9n\xe9ration du fichier ZIP...");let n=await r.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:5}});console.log("ZIP g\xe9n\xe9r\xe9 avec succ\xe8s, taille: ".concat(n.size," octets. T\xe9l\xe9chargement...")),(0,l.saveAs)(n,t),console.log("T\xe9l\xe9chargement du ZIP lanc\xe9")}catch(e){throw console.error("Erreur d\xe9taill\xe9e lors de la cr\xe9ation du ZIP:",e),e}}}},function(e){e.O(0,[565,799,992,971,69,744],function(){return e(e.s=5987)}),_N_E=e.O()}]);