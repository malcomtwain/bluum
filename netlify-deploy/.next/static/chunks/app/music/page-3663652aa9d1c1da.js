(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[404],{1830:function(e,t,a){Promise.resolve().then(a.bind(a,3877))},3877:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var r=a(3827),s=a(9129),l=a(632),i=a(7977);let o=(0,i.Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var n=a(4732);let c=(0,i.Z)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var d=a(489),u=a(6210),x=a(3081);let m=(0,i.Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var g=a(703),h=a(4090),f=a(62),v=a(6288),p=a(8728),b=a(5922),y=a(7907);function j(){let{user:e}=(0,p.aF)(),t=(0,y.useRouter)(),{selectedSongs:a,addSong:i,removeSong:j,updateSong:w,clearSongs:k,cachedSongs:N,setCachedSongs:U}=(0,s.B)(),[C,_]=(0,h.useState)(null),[E,Z]=(0,h.useState)(null),[F,P]=(0,h.useState)(!0),[S,A]=(0,h.useState)({}),[M,z]=(0,h.useState)({artist:"",title:"",coverUrl:""}),R=(0,h.useRef)(null);(0,h.useEffect)(()=>{if(e){var a;"bluumfrerk@gmail.com"!==(null===(a=e.emailAddresses[0])||void 0===a?void 0:a.emailAddress)&&(v.toast.error("Vous n'avez pas acc\xe8s \xe0 cette page"),t.push("/create"))}},[e,t]),(0,h.useEffect)(()=>{(async()=>{if(e)try{P(!0);let t=await (0,b.Bi)(e.id);k(),t.forEach(e=>{var t,a,r;let s={id:e.id,url:e.url,title:e.title,artist:null!==(t=e.artist)&&void 0!==t?t:void 0,duration:e.duration,coverUrl:null!==(a=e.cover_url)&&void 0!==a?a:void 0,cover_url:null!==(r=e.cover_url)&&void 0!==r?r:void 0};i(s)}),U(t)}catch(e){console.error("Error loading songs:",e),v.toast.error("Failed to load your songs")}finally{P(!1)}})()},[e,i,k,U]);let D=(e,t)=>{if(C===e){var a;null===(a=R.current)||void 0===a||a.pause(),_(null)}else R.current&&R.current.pause(),R.current=new Audio(t),R.current.play(),_(e)},B=e=>{let t=a.find(t=>t.id===e);t&&(z({artist:t.artist||"",title:t.title||t.id,coverUrl:t.coverUrl||""}),Z(e))},O=async()=>{if(E&&e)try{await (0,b.$g)(E,{title:M.title,artist:M.artist,cover_url:M.coverUrl}),w(E,{title:M.title,artist:M.artist,coverUrl:M.coverUrl}),Z(null),v.toast.success("Song details updated")}catch(e){console.error("Error updating song:",e),v.toast.error("Failed to update song details")}},I=async t=>{if(window.confirm("Are you sure you want to delete this song?"))try{if(C===t&&R.current&&(R.current.pause(),_(null)),j(t),await (0,b.Sk)(t),e){let t=await (0,b.Bi)(e.id);U(t)}v.toast.success("Song deleted successfully")}catch(t){if(console.error("Error deleting song:",t),v.toast.error("Failed to delete song"),e){let t=await (0,b.Bi)(e.id);k(),t.forEach(e=>{var t,a;i({id:e.id,url:e.url,title:e.title,artist:null!==(t=e.artist)&&void 0!==t?t:void 0,duration:e.duration,coverUrl:null!==(a=e.cover_url)&&void 0!==a?a:void 0})}),U(t)}}},L=(0,h.useCallback)(async t=>{if(!e){v.toast.error("Please sign in to upload songs");return}let a={...S};for(let r of(t.forEach(e=>{a[e.name]=!0}),A(a),t))try{let t=r.name.replace(/\.[^/.]+$/,""),[a="",s=t]=t.split(" - "),l=new FormData;l.append("file",r);let o=await fetch("/api/analyze-audio",{method:"POST",body:l}),n=await o.json();if(!n.success){v.toast.error("Failed to analyze ".concat(r.name,": ").concat(n.error)),A(e=>({...e,[r.name]:!1}));continue}let c=n.duration;if(c>60){v.toast.error("".concat(r.name," exceeds the 1-minute limit (").concat(Math.round(c)," seconds)")),A(e=>({...e,[r.name]:!1}));continue}let d=new FileReader;d.onload=async()=>{let t=d.result;try{var l,o,n;let d=await (0,b.Hq)({user_id:e.id,title:s.trim(),artist:a.trim(),duration:c,url:t,cover_url:null});if(!d)throw Error("Failed to save song data");let u={id:d.id,url:d.url,title:d.title,artist:null!==(l=d.artist)&&void 0!==l?l:void 0,duration:d.duration,coverUrl:null!==(o=d.cover_url)&&void 0!==o?o:void 0,cover_url:null!==(n=d.cover_url)&&void 0!==n?n:void 0};i(u),v.toast.success("".concat(r.name," uploaded successfully (").concat(Math.round(c)," seconds)"))}catch(e){console.error("Error saving song:",e),e instanceof Error?v.toast.error("Failed to upload ".concat(r.name,": ").concat(e.message)):v.toast.error("Failed to upload ".concat(r.name))}finally{A(e=>({...e,[r.name]:!1}))}},d.onerror=()=>{v.toast.error("Failed to read file: ".concat(r.name)),A(e=>({...e,[r.name]:!1}))},d.readAsDataURL(r)}catch(e){console.error("Error processing file:",e),e instanceof Error?v.toast.error("Failed to process ".concat(r.name,": ").concat(e.message)):v.toast.error("Failed to process ".concat(r.name)),A(e=>({...e,[r.name]:!1}))}},[e,i,S]),{getRootProps:H,getInputProps:T,isDragActive:V}=(0,f.uI)({onDrop:L,accept:{"audio/wav":[".wav"],"audio/mpeg":[".mp3"]},multiple:!0}),q=(0,h.useCallback)(e=>{if(e.length>0){let t=e[0],a=new FileReader;a.onload=()=>{let e=a.result;z(t=>({...t,coverUrl:e}))},a.readAsDataURL(t)}},[]),{getRootProps:$,getInputProps:X}=(0,f.uI)({onDrop:q,accept:{"image/*":[".png",".jpg",".jpeg",".webp"]},multiple:!1});return(0,r.jsxs)("div",{className:"p-6 xl:p-8 w-full",children:[(0,r.jsxs)("div",{className:"pt-6 xl:pt-6 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"flex flex-col space-y-6 mb-8 w-full max-w-4xl",children:(0,r.jsxs)("div",{className:"flex items-center justify-start gap-4",children:[(0,r.jsxs)("div",{...H(),className:"relative cursor-pointer",children:[(0,r.jsx)("input",{...T()}),(0,r.jsxs)("button",{className:"flex items-center justify-center gap-2 bg-[#5564ff] text-white rounded-xl py-2 px-4 hover:bg-[#5564ff]/90 transition-colors text-sm dark:bg-[#fafafa] dark:hover:bg-[#fafafa]/90 dark:text-[#0a0a0c] ".concat(e?"":"opacity-50 cursor-not-allowed"),disabled:!e,children:[(0,r.jsx)(l.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{children:"Upload Music"})]}),V&&(0,r.jsx)("div",{className:"absolute inset-0 -m-4 rounded-xl bg-black/90 flex items-center justify-center text-white text-sm",children:"Drop your audio files here (1 min max)"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground dark:text-gray-300",children:[(0,r.jsx)(o,{className:"w-4 h-4"}),(0,r.jsx)("p",{children:"1 minute max"})]}),(0,r.jsx)("div",{className:"h-4 w-px bg-gray-300 dark:bg-gray-700"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground dark:text-gray-300",children:[a.length," / 50 music files used"]})]})}),(0,r.jsx)("div",{className:"w-full max-w-4xl",children:F?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsxs)("div",{className:"relative w-10 h-10 mx-auto mb-4",children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-[#f8d4eb] via-[#ce7acb] to-[#e9bcba] animate-spin"}),(0,r.jsx)("div",{className:"absolute inset-1 rounded-full bg-[#0a0a0c]"})]}),(0,r.jsx)("p",{className:"text-black/60 dark:text-[#fafafa]",children:"Loading your songs..."})]}):0===a.length&&0===Object.values(S).filter(Boolean).length?(0,r.jsx)("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center",children:(0,r.jsxs)("div",{className:"max-w-md",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(n.Z,{className:"w-16 h-16 mx-auto text-gray-400 dark:text-gray-500"})}),(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4 dark:text-white",children:"No songs yet"}),(0,r.jsxs)("p",{className:"text-muted-foreground dark:text-gray-300",children:["Upload your first song to get started",!e&&(0,r.jsx)("span",{className:"block mt-2",children:"Please sign in to upload and save your songs."})]})]})}):(0,r.jsxs)(r.Fragment,{children:[Object.entries(S).filter(e=>{let[t,a]=e;return a}).map(e=>{let[t]=e;return(0,r.jsxs)("div",{className:"bg-white dark:bg-[#0a0a0c] rounded-xl p-4 mb-4 flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"relative w-6 h-6",children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-[#f8d4eb] via-[#ce7acb] to-[#e9bcba] animate-spin"}),(0,r.jsx)("div",{className:"absolute inset-[2px] rounded-full bg-white dark:bg-[#0a0a0c]"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium dark:text-white",children:t}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Uploading and processing..."})]})]},t)}),(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4",children:a.map(e=>{var t;return(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("div",{className:"group relative aspect-square rounded-t-3xl bg-[#1a1a1a] overflow-hidden",children:e.coverUrl||e.cover_url?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.default,{src:e.coverUrl||e.cover_url||"",alt:"".concat(e.title||e.id," cover"),fill:!0,className:"object-cover"}),(0,r.jsxs)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),B(e.id)},className:"absolute top-2 left-2 w-8 h-8 rounded-full bg-[#5564ff] hover:bg-[#5564ff]/90 transition-colors flex items-center justify-center text-white z-20",children:(0,r.jsx)(c,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),I(e.id)},className:"absolute top-2 right-2 w-8 h-8 rounded-full bg-red-500 hover:bg-red-600 transition-colors flex items-center justify-center text-white z-20",children:(0,r.jsx)(d.Z,{className:"w-4 h-4"})}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),D(e.id,e.url)},className:"w-12 h-12 rounded-full bg-white/30 hover:bg-white/50 transition-colors flex items-center justify-center text-white pointer-events-auto",children:C===e.id?(0,r.jsx)(u.Z,{className:"w-6 h-6"}):(0,r.jsx)(x.Z,{className:"w-6 h-6"})})})]})]}):(0,r.jsxs)("div",{className:"h-full w-full flex items-center justify-center",children:[(0,r.jsx)(n.Z,{className:"h-12 w-12 text-gray-400"}),(0,r.jsxs)("div",{className:"absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),B(e.id)},className:"absolute top-2 left-2 w-8 h-8 rounded-full bg-[#5564ff] hover:bg-[#5564ff]/90 transition-colors flex items-center justify-center text-white z-20",children:(0,r.jsx)(c,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),I(e.id)},className:"absolute top-2 right-2 w-8 h-8 rounded-full bg-red-500 hover:bg-red-600 transition-colors flex items-center justify-center text-white z-20",children:(0,r.jsx)(d.Z,{className:"w-4 h-4"})}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,r.jsx)("button",{onClick:t=>{t.stopPropagation(),D(e.id,e.url)},className:"w-12 h-12 rounded-full bg-white/30 hover:bg-white/50 transition-colors flex items-center justify-center text-white pointer-events-auto",children:C===e.id?(0,r.jsx)(u.Z,{className:"w-6 h-6"}):(0,r.jsx)(x.Z,{className:"w-6 h-6"})})})]})]})}),(0,r.jsxs)("div",{className:"p-2 bg-[#0a0a0c] dark:bg-[#fafafa] rounded-b-3xl",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-[#fafafa] dark:text-gray-900 truncate text-center",children:e.title||"Untitled"}),(0,r.jsx)("p",{className:"text-xs text-gray-300 dark:text-gray-600 truncate text-center",children:e.artist||"Unknown artist"}),(0,r.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1 text-center",children:(t=e.duration)?"".concat(Math.floor(t/60),":").concat(Math.floor(t%60).toString().padStart(2,"0")):"0:00"})]})]},e.id)})})]})})]}),E&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-[#0a0a0c] rounded-2xl max-w-md w-full p-6 shadow-xl",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold dark:text-white",children:"Edit Song"}),(0,r.jsx)("button",{onClick:()=>Z(null),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300",children:(0,r.jsx)(m,{className:"w-5 h-5"})})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Title"}),(0,r.jsx)("input",{type:"text",value:M.title,onChange:e=>z({...M,title:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5564ff] bg-white dark:bg-[#18181A] text-gray-900 dark:text-white"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Artist"}),(0,r.jsx)("input",{type:"text",value:M.artist,onChange:e=>z({...M,artist:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#5564ff] bg-white dark:bg-[#18181A] text-gray-900 dark:text-white"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Cover Image"}),(0,r.jsxs)("div",{...$(),className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-50 dark:hover:bg-[#18181A] transition-colors",children:[(0,r.jsx)("input",{...X()}),M.coverUrl?(0,r.jsx)("div",{className:"relative w-32 h-32 mx-auto",children:(0,r.jsx)(g.default,{src:M.coverUrl,alt:"Cover preview",fill:!0,className:"object-cover rounded-lg"})}):(0,r.jsxs)("div",{className:"text-gray-500 dark:text-gray-400",children:[(0,r.jsx)(l.Z,{className:"w-12 h-12 mx-auto mb-2 text-gray-400 dark:text-gray-500"}),(0,r.jsx)("p",{children:"Drop an image here or click to browse"})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,r.jsx)("button",{onClick:()=>Z(null),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-[#18181A] transition-colors",children:"Cancel"}),(0,r.jsx)("button",{onClick:O,className:"px-4 py-2 bg-[#5564ff] text-white rounded-lg hover:bg-[#5564ff]/90 transition-colors",children:"Save Changes"})]})]})]})})]})}},489:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(7977).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},632:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(7977).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])}},function(e){e.O(0,[799,999,743,288,703,426,971,69,744],function(){return e(e.s=1830)}),_N_E=e.O()}]);