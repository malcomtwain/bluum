(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[107],{2743:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/codes",function(){return t(4844)}])},4844:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return n}});var a=t(5893),r=t(7294),c=t(5478),i=t(3296),l=t(6501);function n(){let{user:e}=(0,i.a)(),[s,t]=(0,r.useState)([]),[n,d]=(0,r.useState)(!0),[o,x]=(0,r.useState)(""),[u,m]=(0,r.useState)(1),[h,p]=(0,r.useState)(30),[g,b]=(0,r.useState)(!1),j=async()=>{d(!0);let{data:e,error:s}=await c.OQ.from("invitation_codes").select("*").order("created_at",{ascending:!1});s?l.Am.error("Erreur lors de la r\xe9cup\xe9ration des codes"):t(e||[]),d(!1)},y=async e=>{if(e.preventDefault(),!o.trim()){l.Am.error("Veuillez entrer un code");return}b(!0);let s=new Date;s.setDate(s.getDate()+h);let{data:t,error:a}=await c.OQ.from("invitation_codes").insert([{code:o.trim(),uses_allowed:u,expires_at:s.toISOString()}]).select();a?l.Am.error("Erreur lors de la cr\xe9ation du code"):(l.Am.success("Code cr\xe9\xe9 avec succ\xe8s"),j(),x("")),b(!1)},N=async(e,s)=>{let{error:t}=await c.OQ.from("invitation_codes").update({is_active:!s}).eq("id",e);t?l.Am.error("Erreur lors de la mise \xe0 jour du code"):(l.Am.success("Code ".concat(s?"d\xe9sactiv\xe9":"activ\xe9"," avec succ\xe8s")),j())};return((0,r.useEffect)(()=>{j()},[]),e)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-4",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Gestion des codes d'invitation"}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Cr\xe9er un nouveau code"}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Code"}),(0,a.jsx)("input",{type:"text",value:o,onChange:e=>x(e.target.value),placeholder:"ex: BLUUM-2023",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Utilisations autoris\xe9es"}),(0,a.jsx)("input",{type:"number",min:"1",value:u,onChange:e=>m(parseInt(e.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Expiration (jours)"}),(0,a.jsx)("input",{type:"number",min:"1",value:h,onChange:e=>p(parseInt(e.target.value)),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md",required:!0})]})]}),(0,a.jsx)("button",{type:"submit",disabled:g,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-md font-medium",children:g?"Cr\xe9ation...":"Cr\xe9er le code"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Codes existants"}),n?(0,a.jsx)("p",{children:"Chargement des codes..."}):0===s.length?(0,a.jsx)("p",{children:"Aucun code trouv\xe9"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"text-gray-400 text-left",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2",children:"Code"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Utilisations"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Cr\xe9\xe9 le"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Expire le"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Statut"}),(0,a.jsx)("th",{className:"px-4 py-2",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:s.map(e=>(0,a.jsxs)("tr",{className:"border-t border-gray-700",children:[(0,a.jsx)("td",{className:"px-4 py-3 font-medium",children:e.code}),(0,a.jsxs)("td",{className:"px-4 py-3",children:[e.uses_count," / ",e.uses_allowed]}),(0,a.jsx)("td",{className:"px-4 py-3",children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)("td",{className:"px-4 py-3",children:e.expires_at?new Date(e.expires_at).toLocaleDateString():"Jamais"}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.is_active?"Actif":"Inactif"})}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("button",{onClick:()=>N(e.id,e.is_active),className:"text-xs px-2 py-1 rounded ".concat(e.is_active?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"),children:e.is_active?"D\xe9sactiver":"Activer"})})]},e.id))})]})})]})]})}):(0,a.jsx)("div",{className:"flex min-h-screen flex-col items-center justify-center bg-gray-900 text-white",children:(0,a.jsx)("h1",{className:"text-2xl",children:"Acc\xe8s non autoris\xe9"})})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=2743)}),_N_E=e.O()}]);